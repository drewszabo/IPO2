---
title: "Parameter Optimization with IPO2"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{parameter-optimization}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
# libraries
suppressPackageStartupMessages({
  devtools::load_all()
  library(xcms)
  # library(IPO2)
})

# parallel processing
doParallel::registerDoParallel(parallel::detectCores() - 1)
register(BiocParallel::DoparParam(stop.on.error = FALSE))
```

# Data Import

```{r}
files <- 
  list.files(
    system.file("cdf", package = "faahKO"), 
    pattern = "15", 
    recursive = TRUE, 
    full.names = TRUE
  )

raw_data <- 
  MSnbase::readMSData(files = files, mode = "onDisk") %>% 
  MSnbase::filterRt(c(2500, 3500))
```

# Optimize Peak Picking

```{r}
# cleanup
unlink(
  paste0(
    system.file("scratch", package = "IPO2"), 
    c("/centwave_contours", "/log.txt")
  ), 
  recursive = TRUE
)



cwp_params <- 
  optimize_centwave(
    raw_data = raw_data,
    plot_dir = system.file("scratch", package = "IPO2"),
    log_file = paste0(system.file("scratch", package = "IPO2"), "/log.txt")
  )
```


